// Generated by CoffeeScript 1.9.0
(function() {
  var app;

  app = angular.module("MerlinChat");

  app.controller("rosterController", function($scope, $rootScope) {
    xmpp.registerHandler('presence', function(presence) {
      $rootScope.$broadcast('rosterUpdate', {});
    });
    xmpp.registerHandler('roster', function(iq) {
      $rootScope.$broadcast('rosterUpdate', {});
      xmpp.presence();
    });
    xmpp.registerHandler('message', function(message) {
      $rootScope.$broadcast('newMessage', {
        message: message
      });
    });
    xmpp.registerHandler('vcard', function(iq) {
      $rootScope.$broadcast('rosterUpdate', {});
    });
    xmpp.setupHandlers();
    xmpp.fetchRoster();
    $scope.roster = xmpp.getDefaultRoster();
    $scope.getRoster = function() {
      return $scope.roster;
    };
    $scope.getStatusIcon = function(jid) {
      var classIcon;
      classIcon = "fa ";
      if ($scope.roster[jid]) {
        if ($scope.roster[jid].status === "online") {
          classIcon += ' online fa-circle';
        } else if ($scope.roster[jid].status === "away") {
          classIcon += ' away fa-arrow-circle-right';
        } else if ($scope.roster[jid].status === "offline") {
          classIcon += ' offline fa-times-circle';
        } else if ($scope.roster[jid].status === "dnd") {
          classIcon += 'dnd fa-minus-circle';
        } else {
          classIcon += $scope.roster[jid].status;
        }
      }
      return classIcon;
    };
    $scope.$on("rosterUpdate", function(event, body) {
      $scope.roster = xmpp.getDefaultRoster();
      if (!$scope.$$phase) {
        $scope.$apply();
      }
    });
    $scope.$on("newMessage", function(event, body) {
      $scope.roster = xmpp.getDefaultRoster();
      if (!$scope.$$phase) {
        $scope.$apply();
      }
    });
  });

}).call(this);
